<!--@formatter:off-->
<div class="conversation-input"
     data-bind="with: $root.conversation_input,
                css: {
                  'conversation-input-separator': $root.conversation_input.list_not_bottom(),
                  'conversation-input-editing': $root.conversation_input.is_editing()
                }">

  <!-- ko if: conversation_et() && conversation_et().connection().status() !== z.user.ConnectionStatus.SENT -->
    <div class="controls-left">
      <!-- ko if: input().length > 0 -->
        <user-avatar class="user-avatar-xs cursor-default" params="user: self()"></user-avatar>
      <!-- /ko -->
    </div>

    <!-- ko if: !conversation_et().removed_from_conversation() -->
      <div class="controls-center">
        <textarea id="conversation-input-text"
                  class="conversation-input-text border-theme"
                  data-bind="event: {'keydown': on_input_key_down},
                             focus_on_keydown: true,
                             css: {'ephemeral-input': conversation_et().ephemeral_timer()},
                             enter: on_input_enter,
                             hasFocus: blinking_cursor,
                             textInput: input,
                             resize: input,
                             resize_callback: scroll_message_list,
                             click: on_input_click,
                             attr: {'placeholder': input_tooltip}"
                  data-uie-name="input-message">
        </textarea>
      </div>

      <div class="controls-right">

        <!-- ko ifnot: is_editing -->
          <!-- ko if: show_giphy_button -->
            <span class="controls-right-button button-icon-large icon-gif"
                  data-bind="click: toggle_extensions_menu, l10n_tooltip: z.string.extensions_bubble_button_gif"
                  data-uie-name="do-giphy-popover">
            </span>
          <!-- /ko -->

          <!-- ko if: input().length === 0 -->
            <!-- ko if: conversation_et().is_one2one() -->
              <span id="conversation-input-ephemeral"
                    class="controls-right-button conversation-input-ephemeral"
                    data-bind="l10n_tooltip: z.string.tooltip_conversation_ephemeral"
                    data-uie-name="do-set-ephemeral-timer">
                <!-- ko if: conversation_et().ephemeral_timer() -->
                  <div class="ephemeral-timer-button">
                    <span class="ephemeral-timer-button-unit" data-bind="text: z.util.format_milliseconds_short(conversation_et().ephemeral_timer())[1]"></span>
                    <span class="full-screen" data-bind="text: z.util.format_milliseconds_short(conversation_et().ephemeral_timer())[0]"></span>
                  </div>
                <!-- /ko -->
                <!-- ko ifnot: conversation_et().ephemeral_timer() -->
                  <span class="button-icon-large icon-hourglass"></span>
                <!-- /ko -->
                  <context-menu class="controls-right-button-ephemeral-context"
                                params="entries: get_context_menu_entries(), placement: 'top', tag: 'ephemeral'"
                                tabindex="-1"></context-menu>
              </span>
            <!-- /ko -->

            <span id="conversation-input-location"
                  class="controls-right-button button-icon-large icon-location"
                  data-bind="click: send_location"
                  data-uie-name="do-location">
            </span>

            <label id="conversation-input-photo"
                   class="controls-right-button button-icon-large icon-library"
                   data-bind="attr: {'title': picture_tooltip}">
              <input data-bind="file_select: upload_images" type="file" multiple="multiple"
                     accept=".jpg-large, image/jpeg, image/png, image/bmp, image/gif" data-uie-name="do-share-image"/>
            </label>

            <label id="conversation-input-files"
                     class="controls-right-button button-icon-large icon-attachment"
                     data-bind="attr: {'title': file_tooltip}">
              <input data-bind="file_select: upload_files" type="file" multiple="multiple"
                       accept="*" data-uie-name="do-share-file"/>
            </label>

            <span class="controls-right-button button-icon-large icon-ping"
                  data-bind="click: ping, attr: {'title': ping_tooltip}, css:{'disabled': ping_disabled}"
                  data-uie-name="do-ping">
            </span>
          <!-- /ko -->

          <!-- ko if: window.webkitSpeechRecognition -->
            <span class="controls-right-button button-icon-large icon-microphone"
                  data-bind="click: toggle_speech_recognition, css: {'speech-recognition-activated': is_recognizing}"
                  data-uie-name="do-recognize">

            </span>
          <!-- /ko -->
        <!-- /ko -->

        <!-- ko if: is_editing -->
          <span class="controls-right-button button-icon-large icon-close"
                data-bind="click: cancel_edit"
                data-uie-name="do-cancel-edit">
          </span>
        <!-- /ko -->

        <!-- ko if: input().length > 0 -->
          <span class="controls-right-button controls-right-button-theme text-theme button-icon-large"
                data-bind="click: on_input_enter"
                data-uie-name="do-recognize">
            <span>
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                <path fill="#fff" fill-rule="evenodd" d="M3,12.7270016 C3,13.8260016 3.787,14.3010016 4.758,13.8020016 L14.275,8.90300159 C15.237,8.40800159 15.246,7.59400159 14.275,7.09400159 L4.758,2.19600159 C3.796,1.70000159 3,2.17700159 3,3.27000159 L3,8 L12,8 L3,9.5 L3,12.7270016 Z"></path>
              </svg>
            </span>
          </span>
        <!-- /ko -->
      </div>
    <!-- /ko -->
  <!-- /ko -->
</div>
<!--@formatter:on-->
